import{o as S,c as F,a as K,u as _,R as ye,F as oe,b as i,r as y,w as R,v as me,d as xe,e as q,t as T,f as re,g as se,h as I,i as he,j as be,k as _e,l as U,s as N,p as we,m as Ce,n as ce,q as ue,x as ke,y as Ee,z as Se,A as Fe,B as Le,C as $e}from"./vendor.7128caef.js";const Me=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const g of c.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function x(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function u(o){if(o.ep)return;o.ep=!0;const c=x(o);fetch(o.href,c)}};Me();const Be=i("header",null,null,-1),Pe={setup(L){return(r,x)=>(S(),F(oe,null,[Be,K(_(ye))],64))}},ze="modulepreload",de={},Te="/infomedia/",ae=function(r,x){return!x||x.length===0?r():Promise.all(x.map(u=>{if(u=`${Te}${u}`,u in de)return;de[u]=!0;const o=u.endsWith(".css"),c=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const g=document.createElement("link");if(g.rel=o?"stylesheet":ze,o||(g.as="script",g.crossOrigin=""),g.href=u,document.head.appendChild(g),o)return new Promise((M,t)=>{g.addEventListener("load",M),g.addEventListener("error",t)})})).then(()=>r())},C={title:"Infomedia | How do algorithms make the news?",helpPage:"help-infomedia",esIndex:"infomedia",esTextField:"text",esEntitiesField:"entities",esTitleField:"heading",esSourceField:"sourcename",esDateField:"publishdate",basemap:"/infomedia/data/Infomedia basemap.csv",basemapNodeSizeRatio:1,basemapLabels:[{x:256,y:1058,anchor:"left",label:"European politics"},{x:602,y:907,anchor:"left",label:"International conflict"},{x:892,y:408,anchor:"left",label:"American politics"},{x:963,y:179,anchor:"left",label:"Music industry"},{x:693,y:-801,anchor:"left",label:"Arts & entertainment"},{x:12,y:-1251,anchor:"center",label:"Tech"},{x:-907,y:-588,anchor:"right",label:"Danish business"},{x:-851,y:537,anchor:"right",label:"Research & education"},{x:-473,y:1036,anchor:"right",label:"Danish politics"},{x:-321,y:1170,anchor:"center",label:"The Chinese dilemma"},{x:-217,y:38,anchor:"center",label:"Soccer"},{x:-217,y:38,anchor:"center",label:"Soccer"},{x:-15,y:211,anchor:"center",label:"Climate & development"}],basemapLabelsLines:[[[-121,846],[-321,1130]]],basemapPolygons:[[[155,599],[238,570],[335,614],[396,729],[429,884],[407,1003],[310,1090],[119,1122],[-15,1104],[-119,1032],[-130,967],[-58,931],[28,877],[72,819],[122,718],[137,635],[155,599]],[[-62,870],[31,815],[78,725],[94,604],[55,511],[-39,491],[-70,608],[-78,718],[-133,796],[-121,846],[-62,870]],[[-86,339],[-43,366],[-51,452],[-109,597],[-117,714],[-215,835],[-308,948],[-457,998],[-667,987],[-812,827],[-831,616],[-741,515],[-605,441],[-523,378],[-386,316],[-277,304],[-168,312],[-86,339]],[[-975,550],[-897,620],[-741,612],[-566,546],[-457,472],[-375,386],[-300,238],[-320,148],[-375,89],[-468,74],[-581,82],[-741,144],[-882,222],[-972,335],[-1011,472],[-975,550]],[[-148,109],[-121,78],[-125,-32],[-168,-71],[-242,-71],[-308,-55],[-339,-8],[-289,62],[-234,101],[-179,113],[-148,109]],[[-113,82],[-129,117],[-129,253],[-59,308],[-59,308],[47,331],[121,265],[101,183],[101,183],[51,58],[-8,50],[-8,50],[-74,58],[-113,82]],[[-1280,206],[-1093,327],[-882,327],[-667,234],[-499,144],[-390,70],[-316,-51],[-254,-164],[-195,-316],[-222,-527],[-304,-656],[-652,-913],[-652,-913],[-933,-933],[-1143,-812],[-1342,-515],[-1412,-285],[-1389,0],[-1280,206]],[[18,-403],[212,-391],[453,-502],[496,-625],[496,-625],[488,-779],[417,-1012],[50,-1225],[50,-1225],[-215,-1194],[-413,-1071],[-500,-933],[-464,-739],[-314,-565],[-160,-482],[18,-403]],[[694,-71],[690,-12],[777,150],[915,225],[915,225],[1069,229],[1164,51],[1164,51],[1133,-107],[1065,-166],[935,-174],[828,-162],[733,-119],[694,-71]],[[453,284],[552,229],[643,107],[643,107],[801,-162],[801,-162],[931,-285],[978,-439],[907,-625],[773,-743],[627,-814],[382,-715],[382,-715],[315,-593],[271,-383],[263,-158],[307,150],[307,150],[366,241],[453,284]],[[635,715],[729,743],[880,719],[880,719],[963,652],[1022,533],[1034,427],[994,304],[915,253],[781,237],[623,312],[556,415],[567,632],[567,632],[635,715]],[[315,838],[413,877],[560,881],[686,861],[706,786],[646,581],[575,502],[575,502],[374,442],[374,442],[279,601],[279,601],[295,707],[291,759],[315,838]]]},Re={class:"pure-form",style:{display:"flex",padding:"12px"}},Ie=["onKeyup"],Ne=["href"],Ue={emits:["query"],setup(L,{emit:r}){const x=y("");function u(){r("query",x.value)}return(o,c)=>(S(),F("div",Re,[R(i("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=g=>x.value=g),onKeyup:xe(u,["enter"]),class:"pure-input-rounded",style:{"margin-right":"12px","flex-grow":"1"}},null,40,Ie),[[me,x.value]]),i("button",{class:"pure-button pure-button-primary",onClick:u,style:{width:"200px","margin-right":"12px"}}," Filter "),i("a",{class:"pure-button",href:_(C).helpPage,target:"_blank"},"Help?",8,Ne)]))}};const qe={key:0,style:{"text-align":"center"}},Ae={key:1,style:{"flex-grow":"1",display:"flex","flex-direction":"column","overflow-y":"hidden"}},De={style:{padding:"6px"}},Ve={class:"pure-form"},Oe={for:"show-text",style:{padding:"6px"}},je=I(" Show text "),We={for:"show-entities",style:{padding:"6px"}},He=I(" Show named entities "),Qe={style:{padding:"6px"}},Je={style:{"flex-grow":"1","overflow-y":"auto"}},Ke=["onMouseenter","onClick"],Xe={key:0,class:"card-content",style:{"white-space":"pre-wrap"}},Ye={key:1,class:"pill-box"},Ge=["onMouseenter","onMouseleave"],Ze={key:0,style:{padding:"6px","text-align":"center"}},et={props:{docsTotal:Number,docs:Array,dataLoaded:Boolean,loadBatch:Function},emits:["focusedEntities"],setup(L,{emit:r}){const x=y(!1),u=y(!1);y(!1);const o=y((t,s)=>s.split(".").reduce((n,d)=>n==null?void 0:n[d],t));let c=y(function(t){t&&t._source&&o.value(t._source,C.esEntitiesField)?r("focusedEntities",o.value(t._source,C.esEntitiesField)):r("focusedEntities",[])}),g=y(function(t){r("focusedEntities",[t])}),M=y(function(t){const n=fe.resolve({name:"doc",params:{id:t.replace(/\./gi,"\xB7")}}).href;console.log(n),window.open(n)});return(t,s)=>L.dataLoaded?(S(),F("div",Ae,[i("div",De,[i("form",Ve,[i("fieldset",null,[i("label",Oe,[R(i("input",{type:"checkbox",id:"show-text","onUpdate:modelValue":s[0]||(s[0]=n=>x.value=n)},null,512),[[q,x.value]]),je]),i("label",We,[R(i("input",{type:"checkbox",id:"show-entities","onUpdate:modelValue":s[1]||(s[1]=n=>u.value=n)},null,512),[[q,u.value]]),He])])])]),i("div",Qe,T(Number(L.docsTotal).toLocaleString())+" documents ",1),i("div",Je,[(S(!0),F(oe,null,re(L.docs,n=>(S(),F("div",{onMouseenter:d=>_(c)(n),onMouseleave:s[2]||(s[2]=d=>_(c)()),onClick:d=>_(M)(n._id),class:"card"},[i("h2",null,T(o.value(n._source,_(C).esTitleField)),1),x.value?(S(),F("div",Xe,T(o.value(n._source,_(C).esTextField)),1)):se("",!0),u.value?(S(),F("div",Ye,[(S(!0),F(oe,null,re(o.value(n._source,_(C).esEntitiesField),d=>(S(),F("div",{class:"entity-pill",onMouseenter:m=>_(g)(d),onMouseleave:m=>_(c)(n)},T(d),41,Ge))),256))])):se("",!0),i("small",null,[i("em",null,T(o.value(n._source,_(C).esSourceField)),1),I(" \xA0\xB7\xA0 "+T(o.value(n._source,_(C).esDateField))+" \xA0\xB7\xA0 "+T(n._id),1)])],40,Ke))),256)),L.docs.length<L.docsTotal?(S(),F("div",Ze,[i("button",{class:"pure-button",style:{"font-size":"85%"},onClick:s[3]||(s[3]=n=>t.$emit("loadBatch"))}," Load more... ")])):se("",!0)])])):(S(),F("div",qe,"Loading..."))}};const tt={style:{"flex-grow":"1",display:"flex",position:"relative"}},st=ke('<div style="flex-grow:1;" id="basemap-container"><canvas class="bgCanvas"></canvas><canvas class="hlCanvas"></canvas><canvas class="lbCanvas"></canvas><canvas class="lCanvas"></canvas><canvas class="aCanvas"></canvas><canvas class="hiddenCanvas"></canvas></div><div id="basemap-tooltip"></div>',2),at=[st],ot={props:{focusedEntities:Array,showLabels:Boolean,showClusterShapes:Boolean,showClusterLabels:Boolean,quickButUgly:Boolean},setup(L){const r=L,x=y({});let u;he(()=>{console.log("Loading basemap data...");let t={};be(C.basemap,s=>{s.Id=s.Id.toLowerCase();let n=s.Id;t[n]=s}).then(()=>{console.log("...basemap data loaded."),x.value=t,u=Object.values(x.value).filter(s=>(s.x=+s.x,s.y=+s.y,s.size=+s.size,s.showlabel=s.showlabel=="true",!(isNaN(s.x)||isNaN(s.y)||isNaN(s.size)))),window.addEventListener("resize",o),o()})}),_e(()=>{window.removeEventListener("resize",o)}),U(()=>r.focusedEntities,c),U(()=>r.showLabels,c),U(()=>r.showClusterLabels,g),U(()=>r.showClusterShapes,g),U(()=>r.quickButUgly,o);function o(){console.log("Update basemap. Entities:",(r.focusedEntities||[]).length),g(),c()}function c(){let t={},s=0,n=0,d=0;r.focusedEntities.forEach(l=>{let B=l.score;t[l.label.toLowerCase()]=B,s=Math.max(s,B),d+=B,n++});const m=.2,v=1e3,h=m*d/(s*n),f=h<.3?.3/h:1,A=Math.min(1,v/(f*d/s));u.forEach(l=>{l.highlight=!!t[l.Id];let B=t[l.Id]||0;l.intensity=Math.max(0,Math.min(1,A*f*m*B/s))});const D=r.focusedEntities&&r.focusedEntities.length>0,a=M(),e=a.margin,b=a.width,w=a.height,p=a.x,z=a.y,X=a.sizeRatio,ge=16;let k=N("#basemap-container canvas.hlCanvas").attr("width",b+e.left+e.right).attr("height",w+e.top+e.bottom).node().getContext("2d"),V=N("#basemap-container canvas.lbCanvas").attr("width",b+e.left+e.right).attr("height",w+e.top+e.bottom).node().getContext("2d"),E=N("#basemap-container canvas.lCanvas").attr("width",(b+e.left+e.right)*window.devicePixelRatio).attr("height",(w+e.top+e.bottom)*window.devicePixelRatio).node().getContext("2d");E.setTransform(1,0,0,1,0,0),E.scale(2,2);let O;D?(u.filter(l=>l.highlight).forEach(l=>{k.fillStyle="rgba(255,255,255,"+l.intensity+")",k.beginPath(),k.arc(p(l.x),z(l.y),X*l.size+ge,0,2*Math.PI),k.fill()}),r.quickButUgly||we(k.canvas,0,0,k.canvas.width,k.canvas.height,k.canvas.width/50),k.fillStyle="#FFFFFFBB",r.quickButUgly||u.filter(l=>l.highlight).forEach(l=>{k.beginPath(),k.arc(p(l.x),z(l.y),X*l.size+.6,0,2*Math.PI),k.fill()}),O=u.filter(l=>l.highlight),E.strokeStyle="#999785",E.fillStyle="#FFFFFF"):(k.fillStyle="#766e6c",u.forEach(l=>{k.beginPath(),k.arc(p(l.x),z(l.y),X*l.size+.5,0,2*Math.PI),k.fill()}),O=u.filter(()=>!0),E.strokeStyle="#999785",E.fillStyle="#000000");const Y=8;if(r.showLabels){O.sort(function($,P){return $.showlabel?P.showlabel?P.size-$.size:-1:P.showlabel?1:P.size-$.size});const l=12,B=6,j=1e3;E.font=l+'px "Nunito", serif',E.textAlign="center",E.lineWidth=4,E.lineJoin="round",E.lineCap="round",V.fillStyle="#FFFFFF";const W=5;let H=j;O.filter(($,P)=>P<j).forEach($=>{if(H<=0)return;const P=$.Id,G=E.measureText(P).width+2*B,Z=.8*l+2*B,ee=p($.x)-G/2,te=z($.y)-Z/2+Y,ne=ee+G,le=te+Z;let ie=!0;for(let Q=ee;Q<ne;Q+=W)for(let J=te;J<le;J+=W){var ve=V.getImageData(Q,J,1,1).data;ve[0]>0&&(Q=ne,J=le,ie=!1)}ie&&(H--,V.rect(ee,te,G,Z),V.fill(),E.strokeText(P,p($.x),z($.y)+Y),E.fillText(P,p($.x),z($.y)+Y))})}N(".aCanvas").on("click",function(l){let B=l.layerX||l.offsetX,j=l.layerY||l.offsety,W=Math.round(a.x.invert(B)),H=Math.round(a.y.invert(j));window.polygon.push("["+W+","+H+"]"),console.log(window.polygon.join(","))})}function g(){console.log("Update background"),window.polygon=[];const t=M(),s=t.margin,n=t.width,d=t.height,m=t.nodeMargin,v=t.x,h=t.y,f=t.sizeRatio;let A=N("#basemap-container canvas.bgCanvas").attr("width",n+s.left+s.right).attr("height",d+s.top+s.bottom),a=N("#basemap-container canvas.aCanvas").attr("width",(n+s.left+s.right)*window.devicePixelRatio).attr("height",(d+s.top+s.bottom)*window.devicePixelRatio).node().getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(2,2);let e=A.node().getContext("2d");e.fillStyle="#9ba7a9",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#999785",u.forEach(w=>{e.beginPath(),e.arc(v(w.x),h(w.y),f*w.size+m,0,2*Math.PI),e.fill()}),e.fillStyle="#615e5b",u.forEach(w=>{e.beginPath(),e.arc(v(w.x),h(w.y),f*w.size,0,2*Math.PI),e.fill()}),r.quickButUgly||Ce(e.canvas,0,0,e.canvas.width,e.canvas.height,e.canvas.width/128);const b=function(w){a.beginPath(),w.forEach((p,z)=>{z==0?a.moveTo(v(p[0]),h(p[1])):a.lineTo(v(p[0]),h(p[1]))}),a.stroke()};if(r.showClusterShapes&&(a.lineWidth=.8,a.strokeStyle="#286667",C.basemapPolygons.forEach(b)),r.showClusterLabels){a.lineWidth=.8,a.strokeStyle="#286667",C.basemapLabelsLines.forEach(b);const w=6;a.font='16px "IBM Plex Serif", sans-serif',a.lineWidth=4,a.lineJoin="round",a.lineCap="round",a.strokeStyle="#9ba7a9",a.fillStyle="#286667",C.basemapLabels.forEach(p=>{a.textAlign=p.anchor||"center",a.strokeText(p.label.toUpperCase(),v(p.x),h(p.y)+w),a.fillText(p.label.toUpperCase(),v(p.x),h(p.y)+w)})}}function M(){let t={};const s=document.getElementById("basemap-container").offsetWidth,n=document.getElementById("basemap-container").offsetHeight;t.margin={top:20,right:80,bottom:20,left:80},t.width=s-t.margin.left-t.margin.right,t.height=n-t.margin.top-t.margin.bottom,t.nodeMargin=8;var d=ce(u,f=>f.x),m=ce(u,f=>f.y);if(d[1]-d[0]>m[1]-m[0]){let f=.5*(m[0]+m[1]);m[0]=f-.5*(d[1]-d[0]),m[1]=f+.5*(d[1]-d[0])}else{let f=.5*(d[0]+d[1]);d[0]=f-.5*(m[1]-m[0]),d[1]=f+.5*(m[1]-m[0])}var v=[t.margin.left+3*t.nodeMargin,t.margin.left+t.width-3*t.nodeMargin],h=[t.margin.top+3*t.nodeMargin,t.margin.top+t.height-3*t.nodeMargin];if(v[1]-v[0]<h[1]-h[0]){let f=.5*(h[0]+h[1]);h[0]=f-.5*(v[1]-v[0]),h[1]=f+.5*(v[1]-v[0])}else{let f=.5*(v[0]+v[1]);v[0]=f-.5*(h[1]-h[0]),v[1]=f+.5*(h[1]-h[0])}return t.x=ue().domain(d).range(v),t.y=ue().domain(m).range([h[1],h[0]]),t.sizeRatio=C.basemapNodeSizeRatio*.3,t}return(t,s)=>(S(),F("div",tt,at))}};const nt={style:{display:"flex","flex-grow":"1",overflow:"hidden"}},lt={style:{"flex-grow":"1",display:"flex","flex-direction":"column"}},it={class:"headline"},rt={style:{height:"50px",display:"flex","flex-direction":"column","align-items":"stretch","justify-content":"center"}},ct={style:{padding:"6px"}},ut={class:"pure-form"},dt={for:"show-labels",style:{padding:"6px"}},ht=I(" Show labels "),ft={for:"show-cluster-shapes",style:{padding:"6px"}},pt=I(" Show cluster shapes "),gt={for:"show-cluster-labels",style:{padding:"6px"}},vt=I(" Show cluster labels "),yt={for:"quick-but-ugly",style:{padding:"6px"}},mt=I(" Quick & dirty "),xt={style:{"background-color":"#000","flex-grow":"1",display:"flex"}},bt={class:"documents-panel",style:{width:"600px",display:"flex","flex-direction":"column","align-items":"stretch","justify-content":"center"}},_t={setup(L){let r=y([]),x=y([]),u=y(0),o=y(!1),c=y(""),g=y(25),M=y(0),t=y([]);const s=y(!0),n=y(!0),d=y(!0),m=y(!1),v=function(a,e){const b="elastic",w="9pSJ5siACNtVAUwB2mj8";return fetch("http://10.92.0.111:9200/"+a,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8",Authorization:"Basic "+Se.encode(b+":"+w)},body:JSON.stringify(e)}).then(p=>{if(p.ok)return p.json();console.warn("/!\\ Server returned "+p.status+" : "+p.statusText)})},h=function(){return c.value==""?{match_all:{}}:{query_string:{query:c.value,default_field:C.esTextField}}},f=function(){console.log("Query:",h()),M.value=2*g.value;let a={track_total_hits:!0,from:0,size:M.value,query:h(),aggs:{"entities-agg":{terms:{size:1e4,field:C.esEntitiesField}}}};c.value==""&&(a.sort={},a.sort[C.esDateField]={order:"desc"}),v(C.esIndex+"/_search/",a).then(e=>{console.log(e),r.value=e.hits.hits,e.aggregations&&e.aggregations["entities-agg"]&&e.aggregations["entities-agg"].buckets&&(x.value=e.aggregations["entities-agg"].buckets),o.value=!0,u.value=e.hits.total.value,D.value()}).catch(e=>{console.warn(e)})};let A=y(function(){v("infomedia/_search/",{from:M.value,size:g.value,query:h()}).then(a=>{a.hits.hits.forEach(e=>{r.value.push(e)}),M.value+=g.value}).catch(a=>{console.warn(a)})}),D=y(function(a){a&&a.length>0?t.value=a.map(e=>({label:e,score:1})):c.value==""?t.value=[]:t.value=x.value.map(e=>({label:e.key,score:e.doc_count}))});return he(()=>{f()}),U(c,a=>{f()}),(a,e)=>(S(),F("main",nt,[i("div",lt,[i("div",it,[i("h1",null,"ADD | "+T(_(C).title),1)]),i("div",rt,[K(Ue,{onQuery:e[0]||(e[0]=b=>Ee(c)?c.value=b:c=b)})]),i("div",ct,[i("form",ut,[i("fieldset",null,[i("label",dt,[R(i("input",{type:"checkbox",id:"show-labels","onUpdate:modelValue":e[1]||(e[1]=b=>s.value=b)},null,512),[[q,s.value]]),ht]),i("label",ft,[R(i("input",{type:"checkbox",id:"show-cluster-shapes","onUpdate:modelValue":e[2]||(e[2]=b=>n.value=b)},null,512),[[q,n.value]]),pt]),i("label",gt,[R(i("input",{type:"checkbox",id:"show-cluster-labels","onUpdate:modelValue":e[3]||(e[3]=b=>d.value=b)},null,512),[[q,d.value]]),vt]),i("label",yt,[R(i("input",{type:"checkbox",id:"quick-but-ugly","onUpdate:modelValue":e[4]||(e[4]=b=>m.value=b)},null,512),[[q,m.value]]),mt])])])]),i("div",xt,[K(ot,{"focused-entities":_(t),"show-labels":s.value,"show-cluster-shapes":n.value,"show-cluster-labels":d.value,"quick-but-ugly":m.value},null,8,["focused-entities","show-labels","show-cluster-shapes","show-cluster-labels","quick-but-ugly"])])]),i("div",bt,[K(et,{docs:_(r),"data-loaded":_(o),"docs-total":_(u),onLoadBatch:_(A),onFocusedEntities:_(D)},null,8,["docs","data-loaded","docs-total","onLoadBatch","onFocusedEntities"])])]))}},fe=Fe({history:Le("/infomedia/"),routes:[{path:"/",name:"home",component:_t},{path:"/doc/:id",name:"doc",component:()=>ae(()=>import("./DocView.e87d517c.js"),["assets/DocView.e87d517c.js","assets/DocView.c415fa95.css","assets/vendor.7128caef.js"])},{path:"/help-infomedia",name:"help-infomedia",component:()=>ae(()=>import("./HelpInfomedia.38057ee3.js"),["assets/HelpInfomedia.38057ee3.js","assets/HelpInfomedia.15c8e258.css","assets/plugin-vue_export-helper.21dcd24c.js","assets/vendor.7128caef.js"])},{path:"/help-scopus",name:"help-scopus",component:()=>ae(()=>import("./HelpScopus.e3e7db9a.js"),["assets/HelpScopus.e3e7db9a.js","assets/HelpInfomedia.15c8e258.css","assets/plugin-vue_export-helper.21dcd24c.js","assets/vendor.7128caef.js"])}]}),pe=$e(Pe);pe.use(fe);pe.mount("#app");export{ot as _,C as i};
