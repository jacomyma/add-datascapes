import{o as q,c as N,a as de,u as M,R as Ne,F as we,b as d,r as C,w as K,d as J,v as Oe,e as Ue,f as ee,t as H,g as ke,h as be,i as Y,j as Le,k as Ae,l as Ve,s as $,p as je,m as ze,n as Pe,q as Fe,x as Ie,y as He,z as Re,A as We,B as Qe,C as Xe,D as Ke}from"./vendor.bfe29a18.js";const Je=function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))x(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&x(m)}).observe(document,{childList:!0,subtree:!0});function c(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerpolicy&&(h.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?h.credentials="include":n.crossorigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function x(n){if(n.ep)return;n.ep=!0;const h=c(n);fetch(n.href,h)}};Je();const Ye=d("header",null,null,-1),Ge={setup(T){return(k,c)=>(q(),N(we,null,[Ye,de(M(Ne))],64))}},Ze="modulepreload",De={},et="/scopus/",_e=function(k,c){return!c||c.length===0?k():Promise.all(c.map(x=>{if(x=`${et}${x}`,x in De)return;De[x]=!0;const n=x.endsWith(".css"),h=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${h}`))return;const m=document.createElement("link");if(m.rel=n?"stylesheet":Ze,n||(m.as="script",m.crossOrigin=""),m.href=x,document.head.appendChild(m),n)return new Promise((O,w)=>{m.addEventListener("load",O),m.addEventListener("error",w)})})).then(()=>k())},F={title:"Scopus",helpPage:"help-scopus",esIndex:"scopus",esTextField:"coredata.dc:description",esEntitiesField:"bmEntities",esTitleField:"coredata.dc:title",esSourceField:"coredata.prism:publicationName",esDateField:"coredata.prism:coverDate",basemap:"/scopus/data/Scopus basemap.csv",heatmapSpread:.5,basemapNodeSizeRatio:.1,basemapLabels:[{x:3446,y:2082,anchor:"left",label:"Genetics"},{x:3399,y:1508,anchor:"left",label:"Tools"},{x:3912,y:406,anchor:"left",label:"Repro. medicine"},{x:3353,y:-91,anchor:"left",label:"Microbes & Pathogens"},{x:3368,y:-1146,anchor:"left",label:"Remote sensing"},{x:2313,y:-3319,anchor:"left",label:"Weather forecasting"},{x:1087,y:-3832,anchor:"left",label:"Climatology & oceanography"},{x:466,y:-4344,anchor:"center",label:"Measuring the cosmos"},{x:-760,y:-3723,anchor:"right",label:"Physics"},{x:-2406,y:-3211,anchor:"right",label:"Quantum technology"},{x:-1241,y:-2093,anchor:"center",label:"Mathematics"},{x:-3694,y:-1038,anchor:"right",label:"Energy sys. manag."},{x:-3352,y:1058,anchor:"right",label:"Networks & signal p."},{x:-714,y:576,anchor:"center",label:"Social data science"},{x:-2747,y:2253,anchor:"right",label:"Computer vision"},{x:-1226,y:3712,anchor:"right",label:"Radiotherapy"},{x:-93,y:4177,anchor:"right",label:"Ophthalmology"},{x:155,y:4659,anchor:"center",label:"Orthopedic surgery"},{x:1552,y:3789,anchor:"center",label:"Oncology"},{x:2748,y:3820,anchor:"left",label:"Diabetes"}],basemapLabelsLines:[[[1925,1477],[3834,406]],[[1289,-2900],[1289,-3614]],[[187,2594],[187,4519]],[[1925,2455],[2934,3650]]],basemapPolygons:[[[-791,3851],[-636,3494],[-574,2967],[-698,2765],[-1009,2687],[-1288,2843],[-1505,3169],[-1567,3494],[-1397,3836],[-1086,3945],[-791,3851]],[[-77,2579],[-357,2687],[-512,2982],[-574,3479],[-496,3836],[-264,4007],[-62,3945],[62,3727],[155,3324],[171,3013],[93,2672],[-77,2579]],[[218,3060],[357,2827],[823,2594],[1304,2563],[1940,2563],[2266,2827],[2453,3215],[2422,3727],[2422,3727],[2127,4038],[1351,4177],[1025,4146],[606,3945],[357,3743],[187,3494],[187,3494],[218,3060]],[[1428,2517],[1847,2532],[1847,2532],[2142,2206],[2111,2067],[1971,1911],[1754,1849],[1754,1849],[1521,1880],[1211,2222],[1273,2424],[1428,2517],[1428,2517]],[[1382,1492],[1475,1430],[1692,1384],[1940,1446],[1987,1725],[1816,1818],[1816,1818],[1351,1803],[1289,1601],[1382,1492]],[[2127,1880],[2127,1880],[2111,1539],[2282,902],[2515,639],[2825,530],[3229,437],[3694,530],[4207,856],[4455,1321],[4455,1321],[4362,2687],[4036,3122],[3462,3370],[3462,3370],[2577,3277],[2344,2905],[2251,2548],[2127,1880]],[[4144,1135],[4020,980],[3819,825],[3477,716],[3136,809],[2996,1042],[3011,1306],[3167,1539],[3430,1694],[3850,1725],[4036,1694],[4207,1554],[4222,1461],[4144,1135]],[[3337,390],[3182,421],[2779,452],[2499,561],[2111,996],[1894,1259],[1490,1259],[1211,1042],[1242,685],[1242,685],[1304,266],[1925,-277],[2406,-386],[3073,-495],[3524,-277],[3524,-277],[3772,64],[3617,235],[3337,390]],[[1009,-945],[1025,-1193],[1149,-1441],[1164,-1503],[1475,-1705],[1863,-1814],[2515,-1767],[2748,-1814],[3229,-1721],[3229,-1721],[3601,-1255],[3601,-1255],[3586,-1038],[3430,-836],[2918,-541],[2608,-479],[2282,-479],[2282,-479],[1646,-401],[1289,-479],[1102,-619],[1102,-619],[1040,-758],[1009,-945]],[[1987,-2016],[2158,-1876],[2561,-1891],[3337,-2326],[3462,-2792],[3337,-3226],[3089,-3428],[2670,-3583],[2111,-3490],[1723,-3102],[1661,-2621],[1801,-2295],[1801,-2295],[1987,-2016]],[[683,-1845],[1071,-1876],[1304,-1969],[1475,-2140],[1583,-2373],[1583,-2543],[1506,-2807],[1273,-2947],[916,-2807],[916,-2807],[683,-2559],[559,-2326],[621,-1891],[621,-1891],[683,-1845]],[[543,-2605],[311,-2668],[62,-3025],[-15,-3475],[-15,-3816],[218,-4127],[714,-4127],[823,-3940],[916,-3506],[932,-3273],[900,-3056],[869,-2885],[869,-2885],[792,-2792],[745,-2683],[543,-2605]],[[-124,-3506],[-93,-3288],[-93,-3288],[-124,-3056],[-512,-2761],[-745,-2652],[-978,-2683],[-1304,-2776],[-1490,-3025],[-1598,-3257],[-1490,-3583],[-1335,-3723],[-1335,-3723],[-1040,-3909],[-527,-3847],[-295,-3754],[-139,-3599],[-124,-3506]],[[-1893,-3319],[-1738,-3056],[-1769,-2854],[-2018,-2621],[-2390,-2636],[-2685,-2807],[-2732,-3133],[-2638,-3444],[-2328,-3552],[-2157,-3506],[-2157,-3506],[-1893,-3319]],[[-1412,-2605],[-1583,-2543],[-1769,-2326],[-1862,-2016],[-1816,-1783],[-1459,-1612],[-1117,-1566],[-916,-1674],[-729,-1829],[-605,-2093],[-621,-2342],[-900,-2543],[-1102,-2652],[-1102,-2652],[-1412,-2605]],[[-1893,-867],[-1987,-1224],[-2219,-1472],[-2576,-1705],[-2995,-1845],[-3446,-1829],[-3834,-1705],[-4051,-1457],[-4066,-1146],[-4066,-1146],[-3477,-603],[-3026,-526],[-2732,-541],[-2732,-541],[-2080,-603],[-2080,-603],[-1893,-867]],[[-4222,964],[-3849,1275],[-3352,1337],[-2918,1290],[-2669,1166],[-2281,887],[-2080,576],[-2018,235],[-2142,-60],[-2561,-215],[-2561,-215],[-3477,-184],[-3818,-75],[-4160,235],[-4253,561],[-4253,561],[-4222,964]],[[-1661,996],[-1723,561],[-1707,204],[-1381,-122],[-853,-246],[-372,-262],[47,33],[280,359],[249,701],[-62,1135],[-434,1477],[-791,1616],[-1086,1508],[-1428,1306],[-1428,1306],[-1661,996]],[[-3306,1353],[-2964,1042],[-2576,871],[-2157,747],[-1862,778],[-1598,918],[-1350,1089],[-1195,1368],[-1102,1756],[-1102,2113],[-1241,2439],[-1490,2656],[-1971,2843],[-2437,2843],[-2437,2843],[-3368,2501],[-3477,2129],[-3414,1678],[-3414,1678],[-3306,1353]],[[-15,2563],[-186,2424],[-279,2284],[-279,2284],[-295,1896],[-46,1725],[357,1601],[357,1601],[776,1694],[776,1694],[885,2191],[776,2392],[575,2548],[373,2610],[124,2610],[124,2610],[-15,2563]]]},tt={class:"pure-form",style:{display:"flex",padding:"12px"}},at=["onKeyup"],st=["href"],nt={props:{query:String},emits:["query"],setup(T,{emit:k}){const c=T,x=C("");K(()=>c.query,function(){x.value=c.query});function n(){k("query",x.value)}return(h,m)=>(q(),N("div",tt,[J(d("input",{type:"text","onUpdate:modelValue":m[0]||(m[0]=O=>x.value=O),onKeyup:Ue(n,["enter"]),class:"pure-input-rounded",style:{"margin-right":"12px","flex-grow":"1"}},null,40,at),[[Oe,x.value]]),d("button",{class:"pure-button pure-button-primary",onClick:n,style:{width:"200px","margin-right":"12px"}}," Filter "),d("a",{class:"pure-button",href:M(F).helpPage,target:"_blank"},"Help?",8,st)]))}};const ot={key:0,style:{"text-align":"center"}},lt={key:1,style:{"flex-grow":"1",display:"flex","flex-direction":"column","overflow-y":"hidden"}},it={style:{padding:"6px"}},rt={class:"pure-form"},ct={for:"show-text",style:{padding:"6px"}},ht=Y(" Show text "),ut={for:"show-entities",style:{padding:"6px"}},dt=Y(" Show named entities "),ft={style:{padding:"6px"}},gt={style:{"flex-grow":"1","overflow-y":"auto"}},pt=["onMouseenter","onClick"],yt={key:0,class:"card-content",style:{"white-space":"pre-wrap"}},vt={key:1,class:"pill-box"},mt=["onMouseenter","onMouseleave"],xt={key:0,style:{padding:"6px","text-align":"center"}},bt={props:{docsTotal:Number,docs:Array,dataLoaded:Boolean,loadBatch:Function},emits:["focusedEntities"],setup(T,{emit:k}){const c=C(!1),x=C(!1);C(!1);const n=C((w,E)=>E.split(".").reduce((b,D)=>b==null?void 0:b[D],w));let h=C(function(w){w&&w._source?k("focusedEntities",{highlight:!0,entities:n.value(w._source,F.esEntitiesField)||[]}):k("focusedEntities",{highlight:!1,entities:[]})}),m=C(function(w){k("focusedEntities",{highlight:!0,entities:[w]})}),O=C(function(w){Be.resolve({name:"doc",params:{id:w.replace(/\./gi,"\xB7")}}).href});return(w,E)=>T.dataLoaded?(q(),N("div",lt,[d("div",it,[d("form",rt,[d("fieldset",null,[d("label",ct,[J(d("input",{type:"checkbox",id:"show-text","onUpdate:modelValue":E[0]||(E[0]=b=>c.value=b)},null,512),[[ee,c.value]]),ht]),d("label",ut,[J(d("input",{type:"checkbox",id:"show-entities","onUpdate:modelValue":E[1]||(E[1]=b=>x.value=b)},null,512),[[ee,x.value]]),dt])])])]),d("div",ft,H(Number(T.docsTotal).toLocaleString())+" documents ",1),d("div",gt,[(q(!0),N(we,null,ke(T.docs,b=>(q(),N("div",{onMouseenter:D=>M(h)(b),onMouseleave:E[2]||(E[2]=D=>M(h)()),onClick:D=>M(O)(b._id),class:"card"},[d("h2",null,H(n.value(b._source,M(F).esTitleField)),1),c.value?(q(),N("div",yt,H(n.value(b._source,M(F).esTextField)),1)):be("",!0),x.value?(q(),N("div",vt,[(q(!0),N(we,null,ke(n.value(b._source,M(F).esEntitiesField),D=>(q(),N("div",{class:"entity-pill",onMouseenter:V=>M(m)(D),onMouseleave:V=>M(h)(b)},H(D),41,mt))),256))])):be("",!0),d("small",null,[d("em",null,H(n.value(b._source,M(F).esSourceField)),1),Y(" \xA0\xB7\xA0 "+H(n.value(b._source,M(F).esDateField))+" \xA0\xB7\xA0 "+H(b._id),1)])],40,pt))),256)),T.docs.length<T.docsTotal?(q(),N("div",xt,[d("button",{class:"pure-button",style:{"font-size":"85%"},onClick:E[3]||(E[3]=b=>w.$emit("loadBatch"))}," Load more... ")])):be("",!0)])])):(q(),N("div",ot,"Loading..."))}};const _t={style:{"flex-grow":"1",display:"flex",position:"relative"}},wt=He('<div style="flex-grow:1;" id="basemap-container"><canvas class="bgCanvas"></canvas><canvas class="hlCanvas"></canvas><canvas class="lbCanvas"></canvas><canvas class="lCanvas"></canvas><canvas class="hiddenCanvas"></canvas><canvas class="aCanvas"></canvas></div><div id="basemap-tooltip" class="card"></div>',2),Ct=[wt],St={props:{focusedEntities:Array,showLabels:Boolean,showClusterShapes:Boolean,showClusterLabels:Boolean,quickButUgly:Boolean,highlights:Boolean},emits:["query"],setup(T,{emit:k}){const c=T,x=C({});let n,h,m=1;function O(){var e=[];return m<16777215&&(e.push(m&255),e.push((m&65280)>>8),e.push((m&16711680)>>16),m+=1),"rgb("+e.join(",")+")"}Le(()=>{console.log("Loading basemap data...");let e={};Ae(F.basemap,a=>{a.Id=a.Id.toLowerCase();let f=a.Id;e[f]=a}).then(()=>{console.log("...basemap data loaded."),x.value=e,h={},n=Object.values(x.value).filter(a=>(a.x=+a.x,a.y=+a.y,a.size=+a.size,a.showlabel=a.showlabel=="true",a.hiddenCol=O(),h[a.hiddenCol]=a,!(isNaN(a.x)||isNaN(a.y)||isNaN(a.size)))),window.addEventListener("resize",w),w()})}),Ve(()=>{window.removeEventListener("resize",w)}),K(()=>[c.focusedEntities,c.highlights],E),K(()=>c.showLabels,E),K(()=>c.showClusterLabels,D),K(()=>c.showClusterShapes,D),K(()=>c.quickButUgly,w),document.fonts.ready.then(w);function w(){n&&(D(),E())}function E(){const e=V(),a={h:c.highlights,e:c.focusedEntities,l:c.showLabels,u:c.quickButUgly,s:e},f=te(a),l=b.retrieve("highlight",f);if(l){$("#basemap-container canvas.hlCanvas").node().getContext("2d").putImageData(l.hl,0,0),$("#basemap-container canvas.lbCanvas").node().getContext("2d").putImageData(l.lb,0,0),$("#basemap-container canvas.lCanvas").node().getContext("2d").putImageData(l.l,0,0),$("#basemap-container canvas.hiddenCanvas").node().getContext("2d").putImageData(l.hidden,0,0);return}let s={},r=0,g=0,u=0;c.focusedEntities.forEach(t=>{let y=t.score;s[t.label.toLowerCase()]=y,r=Math.max(r,y),u+=y,g++});const z=.2,S=1e3,v=z*u/(r*g),o=v<.3?.3/v:1,G=Math.min(1,S/(o*u/r));n.forEach(t=>{t.highlight=!!s[t.Id],t.score=s[t.Id]||0,t.intensity=Math.max(0,Math.min(1,G*o*z*t.score/r))});const I=c.highlights,i=e.margin,R=e.width,p=e.height,L=e.x,U=e.y,A=e.sizeRatio,le=16;let _=$("#basemap-container canvas.hlCanvas").attr("width",R+i.left+i.right).attr("height",p+i.top+i.bottom).node().getContext("2d"),W=$("#basemap-container canvas.lbCanvas").attr("width",R+i.left+i.right).attr("height",p+i.top+i.bottom).node().getContext("2d"),P=$("#basemap-container canvas.lCanvas").attr("width",(R+i.left+i.right)*window.devicePixelRatio).attr("height",(p+i.top+i.bottom)*window.devicePixelRatio).node().getContext("2d");P.setTransform(1,0,0,1,0,0),P.scale(window.devicePixelRatio,window.devicePixelRatio);let Z=$("#basemap-container canvas.hiddenCanvas").attr("width",R+i.left+i.right).attr("height",p+i.top+i.bottom).node().getContext("2d"),Q;I?(c.quickButUgly?n.filter(t=>t.highlight).forEach(t=>{let y=A*t.size+1.2*le;_.fillStyle="rgba(255,255,255,"+.5*t.intensity+")",_.fillRect(L(t.x)-y,U(t.y)-y,2*y,2*y)}):(n.filter(t=>t.highlight).forEach(t=>{_.fillStyle="rgba(255,255,255,"+t.intensity+")",_.beginPath(),_.arc(L(t.x),U(t.y),A*t.size+le,0,2*Math.PI),_.fill()}),je(_.canvas,0,0,_.canvas.width,_.canvas.height,_.canvas.width/50),_.fillStyle="#FFFFFFBB",n.filter(t=>t.highlight).forEach(t=>{_.beginPath(),_.arc(L(t.x),U(t.y),A*t.size+.6,0,2*Math.PI),_.fill()})),Q=n.filter(t=>t.highlight),P.strokeStyle="#999785",P.fillStyle="#FFFFFF"):(c.quickButUgly?(_.fillStyle="#6c655e",n.forEach(t=>{_.fillRect(L(t.x),U(t.y),2*(A*t.size+.5),2*(A*t.size+.5))})):(_.fillStyle="#6c655e",n.forEach(t=>{_.beginPath(),_.arc(L(t.x),U(t.y),A*t.size+.5,0,2*Math.PI),_.fill()})),Q=n.filter(()=>!0),P.strokeStyle="#999785",P.fillStyle="#000000"),Q.sort(function(t,y){return t.showlabel?y.showlabel?y.score-t.score||y.size-t.size:-1:y.showlabel?1:y.score-t.score||y.size-t.size}),Q.forEach((t,y)=>{t.order=y});const fe=8;if(c.showLabels){const j=c.quickButUgly?150:1e4;P.font=12+'px "Nunito", sans-serif',P.textAlign="center",P.lineWidth=4,P.lineJoin="round",P.lineCap="round",W.fillStyle="#FFFFFF";const X=5;let se=100;Q.filter((B,ne)=>ne<j).forEach((B,ne)=>{if(se<=0)return;const ce=B.label,ye=P.measureText(ce).width+2*6,ve=.8*12+2*6,me=L(B.x)-ye/2,xe=U(B.y)-ve/2+fe,Se=me+ye,Me=xe+ve;let Ee=!0;for(let he=me;he<Se;he+=X)for(let ue=xe;ue<Me;ue+=X){var qe=W.getImageData(he,ue,1,1).data;qe[0]>0&&(he=Se,ue=Me,Ee=!1)}Ee?(se--,W.rect(me,xe,ye,ve),W.fill(),P.strokeText(ce,L(B.x),U(B.y)+fe),P.fillText(ce,L(B.x),U(B.y)+fe),B.labelDisplayed=!0):B.labelDisplayed=!1})}if(c.highlights&&c.focusedEntities.length==0){P.textAlign="left";const t="No entity to display",y=20,j=p+i.top+i.bottom-20;P.fillText(t,y,j)}Q.sort(function(t,y){return t.labelDisplayed?y.labelDisplayed?y.order-t.order:1:y.labelDisplayed?-1:y.order-t.order});const ie=10;Q.forEach(t=>{Z.fillStyle=t.hiddenCol,Z.fillRect(L(t.x)-ie,U(t.y)-ie,2*ie,2*ie)}),$(".aCanvas").on("click",function(t){let y=t.layerX||t.offsetX,j=t.layerY||t.offsety;Math.round(e.x.invert(y)),Math.round(e.y.invert(j)),k("query",'"'+re.label.replace(/"/gi,"")+'"')});const ge=$("#basemap-tooltip"),pe=$("#basemap-container canvas.aCanvas");let re;$(".aCanvas").on("mousemove",function(t){const y=t.layerX||t.offsetX,j=t.layerY||t.offsety,X=Z.getImageData(y,j,1,1).data,se="rgb("+X[0]+","+X[1]+","+X[2]+")",B=h[se];if(B){re=B;let ne=B.label;ge.html(ne).style("left",ze(t)[0]+20+"px").style("top",ze(t)[1]+"px").style("opacity",1),pe.style("cursor","pointer")}else re=!1,ge.style("opacity",0),pe.style("cursor","default")}),$(".aCanvas").on("mouseleave",function(t){re=!1,ge.style("opacity",0),pe.style("cursor","default")});const Te={hl:_.getImageData(0,0,_.canvas.width,_.canvas.height),lb:W.getImageData(0,0,W.canvas.width,W.canvas.height),l:P.getImageData(0,0,P.canvas.width,P.canvas.height),hidden:Z.getImageData(0,0,Z.canvas.width,Z.canvas.height)};b.store("highlight",f,Te)}const b=function(){let e={};return e.stores={},e.maxStoreSize=25,e.store=function(a,f,l){e.stores[a]===void 0&&(e.stores[a]={});let s=e.stores[a];if(s[f]={ts:Date.now(),data:l},Object.keys(s).length>e.maxStoreSize){let g=1/0,u=!1;for(let z in s)s[z].ts<g&&(g=s[z].ts,u=z);delete s[u]}},e.retrieve=function(a,f){if(e.stores[a]){let l=e.stores[a];if(l[f]!==void 0)return l[f].ts=Date.now(),l[f].data}return!1},e}();function D(){window.polygon=[];const e=V(),a=e.margin,f=e.width,l=e.height,s=e.nodeMargin,r=e.x,g=e.y,u=e.sizeRatio;let z=$("#basemap-container canvas.bgCanvas").attr("width",f+a.left+a.right).attr("height",l+a.top+a.bottom),v=$("#basemap-container canvas.aCanvas").attr("width",(f+a.left+a.right)*window.devicePixelRatio).attr("height",(l+a.top+a.bottom)*window.devicePixelRatio).node().getContext("2d");v.setTransform(1,0,0,1,0,0),v.scale(window.devicePixelRatio,window.devicePixelRatio);let o=z.node().getContext("2d");if(c.quickButUgly)o.fillStyle="#9ba7a9",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle="#999785",n.forEach(I=>{let i=u*I.size+s;o.fillRect(r(I.x)-i,g(I.y)-i,2*i,2*i)}),o.fillStyle="#504132",n.forEach(I=>{let i=u*I.size;o.fillRect(r(I.x)-i,g(I.y)-i,2*i,2*i)});else{o.fillStyle="#000000",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle="rgba(255,255,255)",n.forEach(p=>{o.beginPath(),o.arc(r(p.x),g(p.y),u*p.size+F.heatmapSpread,0,2*Math.PI),o.fill()}),Pe(o.canvas,0,0,o.canvas.width,o.canvas.height,o.canvas.width/32);const I=ae(o.getImageData(0,0,o.canvas.width,o.canvas.height));o.fillStyle="#9ba7a9",o.fillRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle="#999785",n.forEach(p=>{o.beginPath(),o.arc(r(p.x),g(p.y),u*p.size+s,0,2*Math.PI),o.fill()}),o.fillStyle="#504132",n.forEach(p=>{o.beginPath(),o.arc(r(p.x),g(p.y),u*p.size,0,2*Math.PI),o.fill()});const i=p=>Math.pow(Math.max(0,.2+.8*Math.min(1,1.4*p||0)),.6);let R=o.getImageData(0,0,o.canvas.width,o.canvas.height);for(let p=0;p<R.data.length;p+=4){const L=I[p/4];R.data[p]=Math.floor(R.data[p]*(.85+.15*i(L))),R.data[p+1]=Math.floor(R.data[p+1]*(.85+.15*i(L))),R.data[p+2]=Math.floor(R.data[p+2]*(.85+.15*i(L)))}o.putImageData(R,0,0),Pe(o.canvas,0,0,o.canvas.width,o.canvas.height,o.canvas.width/128)}const G=function(I){v.beginPath(),I.forEach((i,R)=>{R==0?v.moveTo(r(i[0]),g(i[1])):v.lineTo(r(i[0]),g(i[1]))}),v.stroke()};if(c.showClusterShapes&&(v.lineWidth=.8,v.strokeStyle="#286667",F.basemapPolygons.forEach(G)),c.showClusterLabels){v.lineWidth=.8,v.strokeStyle="#286667",F.basemapLabelsLines.forEach(G);const I=6;v.font='16px "IBM Plex Serif", serif',v.lineWidth=4,v.lineJoin="round",v.lineCap="round",v.strokeStyle="#9ba7a9",v.fillStyle="#286667",F.basemapLabels.forEach(i=>{v.textAlign=i.anchor||"center",v.strokeText(i.label.toUpperCase(),r(i.x),g(i.y)+I),v.fillText(i.label.toUpperCase(),r(i.x),g(i.y)+I)})}}function V(){let e={};const a=document.getElementById("basemap-container").offsetWidth,f=document.getElementById("basemap-container").offsetHeight;e.margin={top:20,right:80,bottom:20,left:80},e.width=a-e.margin.left-e.margin.right,e.height=f-e.margin.top-e.margin.bottom,e.nodeMargin=8;var l=Fe(n,u=>u.x),s=Fe(n,u=>u.y);if(l[1]-l[0]>s[1]-s[0]){let u=.5*(s[0]+s[1]);s[0]=u-.5*(l[1]-l[0]),s[1]=u+.5*(l[1]-l[0])}else{let u=.5*(l[0]+l[1]);l[0]=u-.5*(s[1]-s[0]),l[1]=u+.5*(s[1]-s[0])}var r=[e.margin.left+3*e.nodeMargin,e.margin.left+e.width-3*e.nodeMargin],g=[e.margin.top+3*e.nodeMargin,e.margin.top+e.height-3*e.nodeMargin];if(r[1]-r[0]<g[1]-g[0]){let u=.5*(g[0]+g[1]);g[0]=u-.5*(r[1]-r[0]),g[1]=u+.5*(r[1]-r[0])}else{let u=.5*(r[0]+r[1]);r[0]=u-.5*(g[1]-g[0]),r[1]=u+.5*(g[1]-g[0])}return e.x=Ie().domain(l).range(r),e.y=Ie().domain(s).range([g[1],g[0]]),e.sizeRatio=F.basemapNodeSizeRatio*.3,e}function te(e){const a=JSON.stringify(e);return oe(a)}function oe(e){let a=0;for(let f=0;f<e.length;f++){let l=e.charCodeAt(f);a=(a<<5)-a+l,a=a&a}return a}function ae(e){let a={};a.elevation_strength=7e-4,a.hillshading_sun_azimuth=Math.PI*.8,a.hillshading_sun_elevation=Math.PI*.3;const f=e.width,l=e.height;let s=new Float64Array((f+1)*(l+1));const r=(z,S,v=.2)=>Math.atan(v*Math.sqrt(z**2+S**2)),g=(z,S)=>Math.atan2(-S,-z),u=function(z,S,v,o){return Math.cos(Math.PI-z-v)*Math.sin(S)*Math.sin(Math.PI*.5-o)+Math.cos(S)*Math.cos(Math.PI*.5-o)};for(let z=0;z<e.data.length;z+=4){e.data[z];const S=z/4,v=S%(f+1)==0?S:S-1,o=S%(f+1)==f+1-1?S:S+1,G=S<f+1?S:S-(f+1),I=S>(f+1)*(l+1-1)?S:S+(f+1),i=e.data[4*v],R=e.data[4*o],p=e.data[4*G],L=e.data[4*I],U=i-R,A=p-L,le=r(U,A,a.elevation_strength*Math.sqrt(f*l)),Ce=g(U,A),_=u(Ce,le,a.hillshading_sun_azimuth,a.hillshading_sun_elevation);s[S]=_}return s}return(e,a)=>(q(),N("div",_t,Ct))}};const Mt={style:{display:"flex","flex-grow":"1",overflow:"hidden"}},Et={style:{"flex-grow":"1",display:"flex","flex-direction":"column"}},kt={class:"headline"},zt={style:{height:"50px",display:"flex","flex-direction":"column","align-items":"stretch","justify-content":"center"}},Pt={style:{padding:"6px"}},Ft={class:"pure-form"},It={for:"show-labels",style:{padding:"6px"}},Rt=Y(" Show labels "),Dt={for:"show-cluster-shapes",style:{padding:"6px"}},Lt=Y(" Show cluster shapes "),Bt={for:"show-cluster-labels",style:{padding:"6px"}},$t=Y(" Show cluster labels "),Tt={for:"quick-but-ugly",style:{padding:"6px"}},qt=Y(" Ugly efficient "),Nt={style:{"background-color":"#000","flex-grow":"1",display:"flex"}},Ot={class:"documents-panel",style:{"min-width":"600px","max-width":"600px",display:"flex","flex-direction":"column","align-items":"stretch","justify-content":"center"}},Ut={setup(T){let k=C([]),c=C([]),x=C(0),n=C(!1),h=C(""),m=C(25),O=C(0),w=C(!1),E=C([]);const b=C(!0),D=C(!0),V=C(!0),te=C(!1),oe=function(l,s){const r="elastic",g="9pSJ5siACNtVAUwB2mj8";return fetch("http://10.92.0.111:9200/"+l,{method:"POST",headers:{"Content-type":"application/json; charset=UTF-8",Authorization:"Basic "+We.encode(r+":"+g)},body:JSON.stringify(s)}).then(u=>{if(u.ok)return u.json();console.warn("/!\\ Server returned "+u.status+" : "+u.statusText)})},ae=function(){return h.value==""?{match_all:{}}:{query_string:{query:h.value,default_field:F.esTextField}}},e=function(){console.log("Query:",ae()),O.value=2*m.value;let l={track_total_hits:!0,from:0,size:O.value,query:ae(),aggs:{"entities-agg":{terms:{size:1e4,field:F.esEntitiesField}}}};h.value==""&&(l.sort={},l.sort[F.esDateField]={order:"desc"}),oe(F.esIndex+"/_search/",l).then(s=>{console.log("Response:",s),k.value=s.hits.hits,s.aggregations&&s.aggregations["entities-agg"]&&s.aggregations["entities-agg"].buckets&&(c.value=s.aggregations["entities-agg"].buckets),n.value=!0,x.value=s.hits.total.value,f.value({highlight:!1,entities:[]})}).catch(s=>{console.warn(s)})};let a=C(function(){oe(F.esIndex+"/_search/",{from:O.value,size:m.value,query:ae()}).then(l=>{l.hits.hits.forEach(s=>{k.value.push(s)}),O.value+=m.value}).catch(l=>{console.warn(l)})}),f=C(function(l){l.highlight?(E.value=l.entities.map(s=>({label:s,score:1})),w.value=!0):h.value==""?(E.value=[],w.value=!1):(E.value=c.value.map(s=>({label:s.key,score:s.doc_count})),w.value=!0)});return Le(()=>{e()}),K(h,l=>{e()}),(l,s)=>(q(),N("main",Mt,[d("div",Et,[d("div",kt,[d("h1",null,"ADD | "+H(M(F).title),1)]),d("div",zt,[de(nt,{onQuery:s[0]||(s[0]=r=>Re(h)?h.value=r:h=r),query:M(h)},null,8,["query"])]),d("div",Pt,[d("form",Ft,[d("fieldset",null,[d("label",It,[J(d("input",{type:"checkbox",id:"show-labels","onUpdate:modelValue":s[1]||(s[1]=r=>b.value=r)},null,512),[[ee,b.value]]),Rt]),d("label",Dt,[J(d("input",{type:"checkbox",id:"show-cluster-shapes","onUpdate:modelValue":s[2]||(s[2]=r=>D.value=r)},null,512),[[ee,D.value]]),Lt]),d("label",Bt,[J(d("input",{type:"checkbox",id:"show-cluster-labels","onUpdate:modelValue":s[3]||(s[3]=r=>V.value=r)},null,512),[[ee,V.value]]),$t]),d("label",Tt,[J(d("input",{type:"checkbox",id:"quick-but-ugly","onUpdate:modelValue":s[4]||(s[4]=r=>te.value=r)},null,512),[[ee,te.value]]),qt])])])]),d("div",Nt,[de(St,{"focused-entities":M(E),highlights:M(w),"show-labels":b.value,"show-cluster-shapes":D.value,"show-cluster-labels":V.value,"quick-but-ugly":te.value,onQuery:s[5]||(s[5]=r=>Re(h)?h.value=r:h=r)},null,8,["focused-entities","highlights","show-labels","show-cluster-shapes","show-cluster-labels","quick-but-ugly"])])]),d("div",Ot,[de(bt,{docs:M(k),"data-loaded":M(n),"docs-total":M(x),onLoadBatch:M(a),onFocusedEntities:M(f)},null,8,["docs","data-loaded","docs-total","onLoadBatch","onFocusedEntities"])])]))}},Be=Qe({history:Xe("/scopus/"),routes:[{path:"/",name:"home",component:Ut},{path:"/doc/:id",name:"doc",component:()=>_e(()=>import("./DocView.525b66a0.js"),["assets/DocView.525b66a0.js","assets/DocView.c415fa95.css","assets/vendor.bfe29a18.js"])},{path:"/help-infomedia",name:"help-infomedia",component:()=>_e(()=>import("./HelpInfomedia.a471bb36.js"),["assets/HelpInfomedia.a471bb36.js","assets/HelpInfomedia.15c8e258.css","assets/plugin-vue_export-helper.21dcd24c.js","assets/vendor.bfe29a18.js"])},{path:"/help-scopus",name:"help-scopus",component:()=>_e(()=>import("./HelpScopus.b34ad812.js"),["assets/HelpScopus.b34ad812.js","assets/HelpInfomedia.15c8e258.css","assets/plugin-vue_export-helper.21dcd24c.js","assets/vendor.bfe29a18.js"])}]}),$e=Ke(Ge);$e.use(Be);$e.mount("#app");export{St as _,F as s};
